
<!DOCTYPE html>
<html>

    <head>
        <title>RateAuthors</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>


        <script src="https://connect.soundcloud.com/sdk.js"></script>
        <script>
          SC.initialize({
            client_id: '39ede846b4c9880b66be516c1c052a0a'
          });

        var all_tracks = [];
        var colouredItem = null;
{#        loadAllTracks();#}
          var enableButtons = 0;
          var enableButtonsThreshold = 0;


        function embed (url) {
          SC.oEmbed(url
            , { auto_play: true
              , maxwidth: 450
              , maxheight: 180
              , show_comments: false }
            , document.getElementById("player")
          );
        }




        function sortAndDisplayTracks(all_tracks){

            all_tracks.sort(function(a, b) {
                return b.playback_count - a.playback_count;
            });

            displayHeaders();
            displayAllTracks(all_tracks);

        }

        function sortAndDisplayTracksByDate(all_tracks){

            all_tracks.sort(function (a, b) {
              if (a.created_at > b.created_at) {
                return -1;
              }
              if (a.created_at < b.created_at) {
                return 1;
              }
              return 0;
            });

            displayHeaders();
            displayAllTracks(all_tracks);

        }

        function sortAndDisplayTracksByTitle(all_tracks){

            all_tracks.sort(function (a, b) {
              if (a.title > b.title) {
                return -1;
              }
              if (a.title < b.title) {
                return 1;
              }
              return 0;
            });

            displayHeaders();
            displayAllTracks(all_tracks);

        }

        function totalPlayCount(all_tracks){
            var totalCount = 0;
            for (i = 0; i < all_tracks.length; i++) {
                totalCount += all_tracks[i].playback_count;
            }

            alert(totalCount);
        }

        function displayHeaders(){
            $('#soundcloud_widget').html(

                "<th></th>"+
                "<th>#</th>"+
                "<th>Track Title</th>"+
                "<th>Play Count</th>"+
                "<th>Author</th>"+
                "<th>Upload Date</th>"
                );
        }

        function displayAllTracks(all_tracks){
            for (i = 0; i < all_tracks.length; i++) {
                var g = document.createElement('tr');
                g.id = all_tracks[i].id;
                g.value = all_tracks[i].permalink_url;
                g.addEventListener("click", function(){
                    embed(this.value);
                    switchColors(this.id);
                });



                var image = document.createElement('img');
                image.src = all_tracks[i].user.avatar_url;
                image.height = 12;
                image.width = 12;


                var tmp = document.createElement("div");
                tmp.appendChild(image);


                var timestamp = all_tracks[i].created_at;
                timestamp = timestamp.replace("+0000", " ");
                timestamp = timestamp.split(" ");
                timestamp = timestamp[0];

                var index = i+1;
                g.innerHTML = '<td>' + tmp.innerHTML + '</td>'
                        + '<td>' + index + '</td>'
                        + '<td>' + all_tracks[i].title + '</td>'
                        + '<td>' + all_tracks[i].playback_count + '</td>'
                        + '<td>' + all_tracks[i].user.username + '</td>'
                        + '<td>' + timestamp + '</td>';
                $('#soundcloud_widget').append(g);



            }
        }

        function loadAllTracks(id){


              SC.get("/tracks", {
                  user_id: id,
                  limit: 300
              },
                    function (tracks) {
                $(tracks).each(function (index, track) {

                    all_tracks.push(track);
                    enableButtons += 1;

        if (enableButtons == enableButtonsThreshold){
                sortAndDisplayTracks(all_tracks);
                enableButton();
            }

                });

            });




        }

        function switchColors(id){
            $('#'+id).children('td').css('background-color','#EBEBEB');
            $('#'+colouredItem).children('td').css('background-color','');
            colouredItem = id;
        }

        function requestUserId(url){
            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: processData,
                error: function(){ alert("failed"); }
            });


        }


        $(document).ready(function() {

            all_tracks = [];


            var haoranyu1 = 'http://api.soundcloud.com/resolve.json?url=http://soundcloud.com/haoran-yu-4&client_id=39ede846b4c9880b66be516c1c052a0a';
            var haoranyu2 = 'http://api.soundcloud.com/resolve.json?url=http://soundcloud.com/haoran-yu-1&client_id=cdb96c0de5bb452f0c477463e9d136d0';
            var haoranyu3 = 'http://api.soundcloud.com/resolve.json?url=http://soundcloud.com/haoran-yu-2&client_id=6c36cd7f5817e3b72b337e5f7b2ee27e';
            var haoranyu4 = 'http://api.soundcloud.com/resolve.json?url=http://soundcloud.com/haoran-yu-3&client_id=08c7660800f3ecace978cd8d95525ee6';
            var haoranyu5 = 'http://api.soundcloud.com/resolve.json?url=http://soundcloud.com/haoran-yu-5&client_id=8ce14ba15ee909a358fe1bface79c4b0';



            requestUserId(haoranyu1);
            requestUserId(haoranyu2);
            requestUserId(haoranyu3);
            requestUserId(haoranyu4);
            requestUserId(haoranyu5);





            });

    function processData(data) {
        $('#response').append(data.id + ", ");
        enableButtonsThreshold += data.track_count;
        loadAllTracks(data.id);

    }

          function enableButton(){

              document.getElementById('sort_by_title').disabled = false;
              document.getElementById('sort_by_play_count').disabled = false;
              document.getElementById('sort_by_upload_date').disabled = false;
              document.getElementById('total_play_count').disabled = false;


            }
{#          window.onload = enableButton;#}

        </script>

        <style>

            body {
                background-color: #ecf8fb;
            }

            table {
                border-collapse: collapse;
            }

            table, th, td {
                border: 1px solid black;


            }
            td {
                cursor: pointer
            }

            tr:hover {
              color: #3176ff;
              background-color: beige ;
            }


        </style>


    </head>

    <body>
        <h1>Hello Raters!</h1>
        Currently the "Blog Rater" app is not yet created, but here is another app called "SoundCloud Tracks Agglomerator". <strong>{{ boldmessage }}</strong><br />
        You are viewing tracks from SoundCloud users: <div id="response"></div>

        <div id="stat"></div>

        <div id="player"></div>

{#        <button id="load_tracks" onclick="sortAndDisplayTracks(all_tracks)"  disabled>Load Data</button>#}
        <button id="sort_by_title" onclick="sortAndDisplayTracksByTitle(all_tracks)" disabled>Sort By Title</button>
        <button id="sort_by_play_count" onclick="sortAndDisplayTracks(all_tracks)" disabled>Sort By Play Count</button>
        <button id="sort_by_upload_date" onclick="sortAndDisplayTracksByDate(all_tracks)" disabled>Sort By Upload Date</button>
        <button id="total_play_count" onclick="totalPlayCount(all_tracks)" disabled>Total Play Count</button>


        <table id = "soundcloud_widget">

        </table>


    </body>

</html>