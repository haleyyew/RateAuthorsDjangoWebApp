
<!DOCTYPE html>
<html>

    <head>
        <title>RateAuthors - Blog Rater</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

        <script>
            var colouredItem = null;

            function displayHeaders(){
                $('#blogger_widget').html(

                    "<th>Name</th>"+
                    "<th>URL</th>"
{#                    +#}
{#                    "<th>Blog ID</th>"#}

                );
            }

            function displayPostsHeaders(){
                $('#user_posts').html(

                    "<th>Post Name</th>"+
                    "<th>URL</th>"+
{#                    "<th>Post ID</th>"+#}
                    "<th>Author</th>"
{#                    "<th>Author ID</th>"#}

                );
            }

            function rateAuthor(){

{#                $('#blogger_user').html(#}
{##}
{##}
{##}
{#                );#}
            }

            function requestUserId(url){
                //alert(url);
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json",
                    success: processData,
                    error: function(){ alert("failed"); }
                });
            }

            function requestPosts(url){
                //alert(url);
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json",
                    success: processPostsData,
                    error: function(){ alert("failed"); }
                });
            }


            function requestAllBlogPosts(id){
                var url = "https://www.googleapis.com/blogger/v3/blogs/"+id.toString()+"/posts?key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw";
                requestPosts(url);
            }

            function processPostsData(data) {

                displayPostsHeaders();


{#                var data = {#}
{#                "items":[#}
{#                    {"url":"John", "id":"Doe"}#}
{#                ]#}
{#                };#}

                //var data = JSON.parse(datum);

                for (var i = 0; i < data.items.length; i++) {
                    //alert(i);
                    var post = data.items[i];

                    //alert(post.url);

                    var g = document.createElement('tr');
                    g.id = post.id;
                    g.value = post.author.id;
                    g.addEventListener("click", function(){
                        switchColors(this.id);
                        rateAuthor(data.items[0].author.displayName);
                    });


                    g.innerHTML =
{#                        '<td>' + post.url + '</td>'#}
{#                        + '<td>' + post.id + '</td>';#}

                        '<td>' + post.title + '</td>'
                        + '<td>' + post.url + '</td>'
{#                        + '<td>' + post.id + '</td>'#}
                        + '<td>' + post.author.displayName + '</td>';
{#                        + '<td>' + post.author.id + '</td>';#}

                    $('#user_posts').append(g);
                }

                //getAuthorInfo(data.items[0].author.id);

            }


            function processData(data) {
                displayHeaders();


                var g = document.createElement('tr');
                g.id = data.id;
                g.value = data.url;
                g.addEventListener("click", function(){
                    switchColors(this.id);
                    requestAllBlogPosts(this.id)
                });


                g.innerHTML =
                    '<td>' + data.name + '</td>'
                    + '<td>' + data.url + '</td>';
{#                    + '<td>' + data.id + '</td>';#}

                $('#blogger_widget').append(g);

            }


            function switchColors(id){
                $('#'+id).children('td').css('background-color','#EBEBEB');
                $('#'+colouredItem).children('td').css('background-color','');
                colouredItem = id;
            }

            $(document).ready(function() {
                var url = '{{ search }}';
                url = url.replace("&amp;", "&");

                //requestUserId('https://www.googleapis.com/blogger/v3/blogs/byurl?url=http://haleyyew.blogspot.ca/&key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw');
                requestUserId(url);
            });
        </script>


        <style>
            body {
                background-color: #ecf8fb;
            }
            table {
                border-collapse: collapse;
            }
            table, th, td {
                border: 1px solid black;
            }
            td {
                cursor: pointer
            }
            tr:hover {
              color: #3176ff;
              background-color: beige ;
            }
        </style>

    </head>

{#AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw     #}

    <body>
        <h1>Blog Rater</h1>
        <strong>{{ boldmessage }}</strong><br />

        Blog info:<br>
        <table id = "blogger_widget">
        </table>
        <br>Latest posts:<br>
        <table id = "user_posts">
        </table>
        <br>Rate this author:<br>
        <table id = "blogger_user">
            <tr>
                <th>Author</th>
                <th>Rating</th>
                <th>Add 1 Rating</th>
            </tr>
            <tr>
                <td id="author_name"></td>
                <td id="author_rating"></td>
                <td id="add_one"></td>
            </tr>
        </table>


    </body>

</html>