
<!DOCTYPE html>
<html>

    <head>
        <title>RateAuthors - Blog Rater</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

        <script>
            var colouredItem = null;
            var clickedItemId = null;
            var tableIndex = 1;

            function displayHeaders(){
                $('#blogger_widget').html(

                    "<th>Name</th>"+
                    "<th>URL</th>"
{#                    +#}
{#                    "<th>Blog ID</th>"#}

                );
            }

            function displayPostsHeaders(){

                $('#user_posts').html(

                    "<th>#</th>"+

                    "<th>Post Name</th>"+

{#                    "<th>Post ID</th>"+#}
                    "<th>Author</th>"+
                    "<th>Author Rating</th>"

                );
            }


{#            function rateAuthor(){#}
{##}
{##}
{#            }#}

            function requestUserId(url){
                //alert(url);
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json",
                    success: processData,
                    error: function(){ alert("failed"); }
                });
            }

            function requestPosts(url){
                //alert(url);
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json",
                    success: processPostsData,
                    error: function(){ alert("failed"); }
                });
            }
            function requestPost(url){
                //alert(url);
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json",
                    success: processPostData,
                    error: function(){ alert("failed"); }
                });
            }

            function requestAllBlogPosts(id){
                clickedItemId = id;
                //https://www.googleapis.com/blogger/v3/blogs/8986028814956128839/posts?key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw
                var url = "https://www.googleapis.com/blogger/v3/blogs/"+id.toString()+"/posts?key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw";
                requestPosts(url);
                //alert('here');
            }

            function requestAllBlogPostsWithToken(id, token){
                var url = "https://www.googleapis.com/blogger/v3/blogs/"+id.toString()+"/posts?pageToken="+token+"&key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw";
                //alert(url);
                requestPosts(url);
            }

            function getPost(author, id){
                var url = "https://www.googleapis.com/blogger/v3/blogs/"+author.toString()+"/posts/"+id.toString()+"?key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw";
                requestPost(url);
                //alert(url);
            }

            function processPostData(data){
                $('#blog_post').html(data.content);
            }

            function processPostsData(data) {


                for (var i = 0; i < data.items.length; i++) {

                    var post = data.items[i];

                    var g = document.createElement('tr');
                    g.id = post.id;
                    g.value = post.author.id;
                    g.url = post.blog.id;
                    g.addEventListener("click", function(){
                        switchColors(this.id);
                        getPost(this.url, this.id);
                        document.getElementById("blog_post").scrollIntoView();
                    });

                    var button =
                    '<form action="/blograter/get_author/" method="get" id="form1">'+
                            '<input type="hidden" name="id" value='+ g.value+'>'+
                            '<input type="hidden" name="name" value='+ data.items[0].author.displayName+'>'+
                    '<input type="submit" class="btn" value="View Ratings" >'+
                    '</form>';


                    g.innerHTML =

                        '<td>' + tableIndex + '</td>'
                        + '<td>' + post.title + '</td>'
{#                        + '<td>' + post.url + '</td>'#}

{#                        + '<td>' + post.id + '</td>'#}
                        + '<td>' + post.author.displayName + '</td>'
                        + '<td>' + button + '</td>';
{#                        + '<td>' + post.author.id + '</td>';#}

                    $('#user_posts').append(g);
                    tableIndex++;
                }


                var token = data.nextPageToken;
                if (token != null){requestAllBlogPostsWithToken(clickedItemId, token);}


                //getAuthorInfo(data.items[0].author.id);

            }


            function processData(data) {
                displayHeaders();

                requestAllBlogPosts(data.id);
                var g = document.createElement('tr');
                g.id = data.id;
                g.value = data.url;
                g.addEventListener("click", function(){

                    switchColors(this.id);
                    tableIndex = 1;
                    displayPostsHeaders();
                    requestAllBlogPosts(this.id);

                });


                g.innerHTML =
                    '<td>' + data.name + '</td>'
                    + '<td>' + data.url + '</td>';
{#                    + '<td>' + data.id + '</td>';#}

                $('#blogger_widget').append(g);

            }


            function switchColors(id){
                $('#'+id).children('td').css('background-color','#EBEBEB');
                $('#'+colouredItem).children('td').css('background-color','');
                colouredItem = id;
            }

            $(document).ready(function() {
                var url = '{{ search }}';
                url = url.replace("&amp;", "&");
                displayPostsHeaders();

                //requestUserId('https://www.googleapis.com/blogger/v3/blogs/byurl?url=http://haleyyew.blogspot.ca/&key=AIzaSyBVfRXsS2J63CmmGbf3_vJin_Nk_3atSPw');
                requestUserId(url);

            });
        </script>


        <style>
            body {
                background-color: #ecf8fb;
            }
            table {
                border-collapse: collapse;
            }
            table, th, td {
                border: 1px solid black;
            }
            td {
                cursor: pointer
            }
            tr:hover {
              color: #3176ff;
              background-color: beige ;
            }
        </style>

    </head>



    <body>
        <a href="/">Home</a>
        <h1>Blog Rater</h1>
        <A NAME="top_page">
        <strong>{{ boldmessage }}</strong><br />
        <form method="get" action="/blograter/">
            <input id="textbox" name="url" type="text" size='100' value=
                '{{ search }}'>
            <input type="submit" class="btn" value="View Author Ratings" >
        </form>

        Blog info:<br>
        <table id = "blogger_widget">
        </table>
        <br>All posts of blog:<br>
        <table id = "user_posts">
        </table>
        <br>Post Content:<br>
        <table id = "blog_post">
        </table>
        <A HREF="#top_page">Back to the top</A>



    </body>

</html>